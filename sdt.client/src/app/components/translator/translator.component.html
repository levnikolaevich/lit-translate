<div class="translator-container">
  <div class="main-card">
    <!-- Header Section -->
    <div class="header-section">
      <h1>Smart Document Translator</h1>
      <p>Переводите документы с помощью искусственного интеллекта</p>
    </div>

    <div class="content-section">
      <!-- File Upload Section -->
      <div class="upload-section fade-in-up">
        <div class="section-title">Загрузка документа</div>
        <nz-upload
          nzType="drag"
          nzLimit="1"
          [nzMultiple]="false"
          (nzChange)="handleDocumentUpload($event)"
          [nzAccept]="'application/vnd.openxmlformats-officedocument.wordprocessingml.document'"
          [nzShowUploadList]="true"
        >
          <p class="ant-upload-drag-icon">
            <span nz-icon nzType="inbox"></span>
          </p>
          <p class="ant-upload-text">Нажмите или перетащите файл для загрузки</p>
          <p class="ant-upload-hint">
            Поддерживается только формат MS Word (.docx)
          </p>
        </nz-upload>
      </div>

      <!-- Configuration Section -->
      <div class="configuration-section slide-in-right">
        <div class="section-title">Настройки перевода</div>
        
        <nz-row [nzGutter]="16" class="config-row">
          <nz-col nzSpan="8">
            <label class="config-label">Компания:</label>
            <nz-select
              [(ngModel)]="selectedAiCompanyId"
              nzPlaceHolder="Выберите компанию"
              style="width: 100%;"
            >
              <nz-option *ngFor="let company of aiCompanies" 
                [nzLabel]="company.name" 
                [nzValue]="company.id">
              </nz-option>
            </nz-select>
          </nz-col>
          
          <nz-col nzSpan="8">
            <label class="config-label">Модель:</label>
            <nz-select
              [(ngModel)]="translationRequest.languageModelId"
              nzPlaceHolder="Выберите модель"
              style="width: 100%;"
            >
              <nz-option *ngFor="let model of aiLanguageModels" 
                [nzLabel]="model.name" 
                [nzValue]="model.id">
              </nz-option>
            </nz-select>
          </nz-col>
          
          <nz-col nzSpan="8">
            <label class="config-label">API Ключ:</label>
            <input 
              nz-input
              [(ngModel)]="translationRequest.apiKey"
              placeholder="Введите ваш API ключ"
              type="password"
              style="width: 100%;"
            />
          </nz-col>
        </nz-row>

        <nz-row [nzGutter]="16" class="config-row">
          <nz-col nzSpan="18">
            <label class="config-label">Языки перевода:</label>
            <nz-select
              nzMode="multiple"
              [(ngModel)]="translationRequest.targetLanguageIds"
              nzPlaceHolder="Выберите языки для перевода"
              style="width: 100%;"
            >
              <nz-option *ngFor="let language of languages" 
                [nzLabel]="language.name" 
                [nzValue]="language.id">
              </nz-option>
            </nz-select>
          </nz-col>
          
          <nz-col nzSpan="6">
            <label class="config-label">&nbsp;</label>
            <button 
              nz-button 
              nzType="primary" 
              (click)="onTranslate()" 
              class="translate-button"
              style="width: 100%;" 
              [disabled]="!isTranslationRequestValid()"
            >
              <span nz-icon nzType="translation"></span>
              Перевести
            </button>
          </nz-col>
        </nz-row>
      </div>

      <!-- Documents Section -->
      <div class="documents-section fade-in-up" *ngIf="userDocuments && userDocuments.length > 0">
        <div class="section-title">Мои документы</div>
        <div class="document-selector">
          <nz-select
            [(ngModel)]="selectedUserDocumentId"
            nzPlaceHolder="Выберите документ"
            style="width: 100%;"
            (ngModelChange)="getTranslationTasks()"
          >
            <nz-option *ngFor="let document of userDocuments" 
              [nzLabel]="document.name" 
              [nzValue]="document.id">
            </nz-option>
          </nz-select>
          <button 
            nz-button 
            nzType="primary" 
            nzShape="circle" 
            class="download-btn"
            nzTooltipTitle="Скачать оригинал"
          >
            <span nz-icon nzType="download"></span>
          </button>
        </div>
      </div>

      <!-- Document Info -->
      <div class="document-info fade-in-up" *ngIf="translationTasks?.documentInfo">
        <nz-descriptions [nzBordered]="true" [nzColumn]="4" [nzSize]="size">
          <nz-descriptions-item nzTitle="Дата загрузки">
            <span nz-icon nzType="calendar"></span>
            {{ translationTasks?.documentInfo?.uploadDateTime }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Количество токенов">
            <span nz-icon nzType="file-text"></span>
            {{ translationTasks?.documentInfo?.tokenCount | number }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Стоимость">
            <span nz-icon nzType="dollar"></span>
            {{ translationTasks?.documentInfo?.price | currency:'USD':'symbol':'1.4-4' }}
          </nz-descriptions-item>
          <nz-descriptions-item nzTitle="Прогресс">
            <div class="progress-bar">
              <div 
                class="progress-fill" 
                [style.width.%]="translationTasks?.documentInfo?.progress"
              ></div>
            </div>
            {{ translationTasks?.documentInfo?.progress }}%
          </nz-descriptions-item>
        </nz-descriptions>
      </div>

      <!-- Translation Tasks Table -->
      <div class="tasks-section slide-in-right" *ngIf="translationTasks && translationTasks.translationTasks.length > 0">
        <div class="section-title">Задачи перевода</div>
        <nz-table
          [nzFrontPagination]="false"
          [nzBordered]="true"
          [nzData]="translationTasks.translationTasks"
          [nzSize]="'middle'"
        >
          <thead>
            <tr>
              <th nzAlign="center">№</th>
              <th>Промпт</th>
              <th nzAlign="center">Язык</th>
              <th nzAlign="center">Токены</th>
              <th nzAlign="center">Стоимость</th>
              <th nzAlign="center">Прогресс</th>
              <th nzAlign="center">Статус</th>
              <th nzAlign="center">Действия</th>
            </tr>
          </thead>      
          <tbody>
            <tr *ngFor="let task of translationTasks.translationTasks; let i = index">
              <td nzAlign="center">{{ i + 1 }}</td>
              <td>
                <div style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                  {{ task.prompt }}
                </div>
              </td>
              <td nzAlign="center">
                <strong>{{ task.targetLanguage }}</strong>
              </td>
              <td nzAlign="center">{{ task.tokenCount | number }}</td>
              <td nzAlign="center">{{ task.price | currency:'USD':'symbol':'1.4-4' }}</td>
              <td nzAlign="center">
                <div class="progress-bar">
                  <div 
                    class="progress-fill" 
                    [style.width.%]="task.progress"
                  ></div>
                </div>
                {{ task.progress }}%
              </td>
              <td nzAlign="center">
                <span 
                  class="status-badge"
                  [ngClass]="{
                    'status-new': task.status === 'New',
                    'status-inprogress': task.status === 'InProgress',
                    'status-completed': task.status === 'Completed',
                    'status-error': task.status === 'Error'
                  }"
                >
                  {{ getStatusText(task.status) }}
                </span>
              </td>
              <td nzAlign="center">
                <div class="action-buttons">
                  <button 
                    nz-button 
                    nzType="primary" 
                    nzShape="circle" 
                    class="run-btn"
                    nzTooltipTitle="Запустить перевод" 
                    (click)="onRunTranslation(task)" 
                    [disabled]="task.status !== 'New'"
                  >
                    <span nz-icon nzType="play-circle"></span>
                  </button>
                  <button 
                    nz-button 
                    nzType="primary" 
                    nzShape="circle" 
                    class="download-btn"
                    nzTooltipTitle="Скачать перевод" 
                    (click)="onDownloadTranslation(task)" 
                    [disabled]="!task.translatedDocumentId"
                  >
                    <span nz-icon nzType="download"></span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </div>
    </div>
  </div>
</div>